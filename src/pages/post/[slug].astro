---
import { PortableText } from "@portabletext/react";
import BaseLayout from "../../layouts/BaseLayout.astro";
import { sanityClient, urlFor } from "../../lib/sanity";

export async function getStaticPaths() {
  const posts = await sanityClient.fetch(`*[_type == "post"]`);
  return posts.map((post: any) => ({
    params: { slug: post.slug.current },
    props: { post },
  }));
}

interface Props {
  post: any;
}

const { post } = Astro.props;
---

<BaseLayout title={post.title}>
  <article class="min-h-screen bg-white text-black">
    <header class="border-b-4 border-black pb-8 mb-12">
      <div class="container mx-auto px-4 pt-12">
        <div class="flex flex-col gap-4">
          <span
            class="font-mono text-sm bg-black text-white inline-block w-fit px-2 py-1 uppercase"
          >
            {new Date(post.publishedAt).toLocaleDateString("pt-BR")}
          </span>

          <h1
            class="text-5xl md:text-8xl font-black uppercase leading-[0.9] tracking-tighter break-words"
          >
            {post.title}
          </h1>
        </div>
      </div>

      {
        post.mainImage && (
          <div class="mt-8 border-y-4 border-black overflow-hidden">
            <img
              src={urlFor(post.mainImage).width(1200).url()}
              alt={post.title}
              class="w-full h-[60vh] object-cover grayscale hover:grayscale-0 transition-all duration-500"
            />
          </div>
        )
      }
    </header>

    <div class="container mx-auto px-4 max-w-3xl pb-20">
      <div
        class="prose prose-lg md:prose-2xl max-w-none font-mono text-black leading-relaxed marker:text-black prose-headings:font-headline prose-headings:uppercase prose-headings:font-black prose-p:text-black prose-p:text-justify prose-img:border-4 prose-img:border-black prose-a:text-safety-orange prose-a:no-underline hover:prose-a:underline"
      >
        <PortableText value={post.body} />
      </div>

      <div class="mt-16 border-t-4 border-black pt-8">
        <a
          href="/"
          class="inline-block px-8 py-3 bg-black text-white font-mono font-bold uppercase hover:bg-red-600 transition-colors shadow-[4px_4px_0px_0px_rgba(0,0,0,0.3)]"
        >
          ‚Üê Voltar para o Caos
        </a>
      </div>
    </div>
  </article>
</BaseLayout>
